{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ES/Desktop/2025/EstateIQIndia/app/api/property-valuation/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { GoogleGenAI } from \"@google/genai\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { location, propertyType, details, userLat, userLng } = await request.json();\r\n\r\n    const apiKey = process.env.GEMINI_API_KEY || '';\r\n\r\n    console.log('ðŸ  Property valuation requested for:', location);\r\n    console.log('ðŸ”‘ API Key Status:', apiKey ? `Loaded (length: ${apiKey.length})` : 'âŒ EMPTY');\r\n\r\n    if (!apiKey) {\r\n      return NextResponse.json(\r\n        { error: 'API Key missing' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    if (!location || !propertyType) {\r\n      return NextResponse.json(\r\n        { error: 'Location and property type are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Initialize GoogleGenAI inside the function\r\n    const ai = new GoogleGenAI({ apiKey });\r\n\r\n    const prompt = `\r\n      Analyze real estate investment for a ${propertyType} in ${location}, India.\r\n      ${details ? `Property details: ${details}` : ''}\r\n\r\n      Provide a comprehensive analysis including:\r\n\r\n      ## Price Estimation\r\n      - Current market price range (â‚¹ per sq.ft or total price)\r\n      - Comparison with nearby areas\r\n      - Recent price trends in the location\r\n\r\n      ## Location Analysis\r\n      Using Google Maps data, identify:\r\n      - Nearby schools, colleges, and educational institutions\r\n      - Healthcare facilities (hospitals, clinics)\r\n      - Public transport connectivity (metro, bus, railway)\r\n      - Shopping centers, malls, markets\r\n      - Parks, recreational facilities\r\n      - Distance from major landmarks/IT hubs\r\n\r\n      ## Investment Potential\r\n      - Growth factors (upcoming infrastructure, IT parks, metro lines)\r\n      - Rental yield potential\r\n      - Capital appreciation forecast (3-5 years)\r\n      - Risk factors to consider\r\n\r\n      ## Confidence Score\r\n      Rate your analysis confidence: Low/Medium/High\r\n\r\n      Use Google Search for latest price trends and Google Maps for precise location amenities.\r\n      Format the response in clear markdown with sections.\r\n    `;\r\n\r\n    const config: any = {\r\n      tools: [{ googleSearch: {} }, { googleMaps: {} }],\r\n    };\r\n\r\n    if (userLat && userLng) {\r\n      config.toolConfig = {\r\n        retrievalConfig: {\r\n          latLng: {\r\n            latitude: userLat,\r\n            longitude: userLng\r\n          }\r\n        }\r\n      };\r\n    }\r\n\r\n    const response = await ai.models.generateContent({\r\n      model: \"gemini-3-pro-preview\",\r\n      contents: prompt,\r\n      config,\r\n    });\r\n\r\n    const text = response.text;\r\n    if (!text) {\r\n      throw new Error(\"No response from AI\");\r\n    }\r\n\r\n    const groundingChunks = response.candidates?.[0]?.groundingMetadata?.groundingChunks || [];\r\n\r\n    // Extract key information from the response text\r\n    const extractSection = (text: string, keyword: string): string[] => {\r\n      const lines = text.split('\\n');\r\n      const items: string[] = [];\r\n      let inSection = false;\r\n\r\n      for (const line of lines) {\r\n        if (line.toLowerCase().includes(keyword.toLowerCase())) {\r\n          inSection = true;\r\n          continue;\r\n        }\r\n        if (inSection && line.trim().startsWith('-')) {\r\n          items.push(line.trim().substring(1).trim());\r\n        } else if (inSection && line.startsWith('#')) {\r\n          break;\r\n        }\r\n      }\r\n      return items;\r\n    };\r\n\r\n    const nearbyAmenities = extractSection(text, 'location analysis');\r\n    const growthFactors = extractSection(text, 'growth factors');\r\n    const riskFactors = extractSection(text, 'risk factors');\r\n\r\n    // Extract price range if mentioned\r\n    const priceMatch = text.match(/â‚¹[\\d,]+-?[\\d,]*/g);\r\n    const estimatedPriceRange = priceMatch ? priceMatch[0] : \"See detailed analysis\";\r\n\r\n    // Extract confidence score\r\n    let confidenceScore = \"Medium\";\r\n    if (text.toLowerCase().includes('high confidence') || text.toLowerCase().includes('confidence: high')) {\r\n      confidenceScore = \"High\";\r\n    } else if (text.toLowerCase().includes('low confidence') || text.toLowerCase().includes('confidence: low')) {\r\n      confidenceScore = \"Low\";\r\n    }\r\n\r\n    return NextResponse.json({\r\n      estimatedPriceRange,\r\n      confidenceScore,\r\n      locationAnalysis: text,\r\n      nearbyAmenities,\r\n      growthFactors,\r\n      riskFactors,\r\n      groundingChunks\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Valuation Error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || 'Failed to analyze property' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}